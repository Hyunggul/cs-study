# 17장 내용 협상과 트랜스코딩

* 종종 하나의 URL이 여러 리소스에 대응할 필요가 있는 경우가 있다.

* 콘텐츠를 여러 언어로 제공하려고 하는 웹 사이트의 예를 들어보자.
    - 만약 '죠의 하드웨어' 같은 사이트가 프랑스어 사용자 고객과 영어 사용자 고객을 동시에 갖고 있다면
    - 웹 사이트를 두 언어별로 모두 제공해주고 싶을 것이다.

    - 그런데 이 경우 죠의 고객 중 한명이 해당 URL을 요청했을 때, 서버는 어떤 버전을 제공해 주어야 하는가?

    * 이상적으로 동작한다면, 서버는 영어 사용자에게는 영어 버전을, 프랑스 사용자에게는 프랑스어 버전을 보내줄 것이다.

* HTTP는 클라이언트와 서버가 이러한 판단을 할 수 있도록 `내용 협상`(content-negotiation) 방법을 제공한다.

* 이 방법을 이용해서 하나의 URL이 여러 가지 리소스 중 적합한 것에 대응되도록 할 수 있다.

* 서버는 또한 특정 URL에 대해 어떤 콘텐츠가 클라이언트에게 보내주기 가장 적절한지에 대한 다른 판단도 할 수 있어야 한다.
    - 어떤 경우에는 서버가 커스터마이징된 페이지를 자동으로 생성하기도 한다.

* 트랜스코딩은 HTTP 클라이언트와 서버 사이의 내용 협상에 대한 응답에서 수행된다.

## 17.1 내용 협상 기법

기법|어떻게 동작하는가|장점|단점
---|---|---|---
클라이언트 주도|클라이언트가 요청을 보내면, 서버는 클라이언트에게 선택지를 보내즈고, 클라이언트가 선택한다.|서버 입장에서 가장 구현하기 쉽다. 클라이언트는 최선의 선택을 할 수 있다.|대기시간이 증가한다. 즉, 올바른 콘텐츠를 얻으려면 최소 두번의 요청이 필요하다.
서버 주도|서버가 클라이언트의 요청 헤더를 검증해서 어떤 버전을 제공할지 결정한다.|클라이언트 주도 협상보다 빠르다. HTTP는 서버가 가장 적절한 것을 선택할 수 있도록 q값 메커니즘을 제공하고, 서버가 다운스트림 장치에게 요청이 어떻게 평가되는지 말해줄 수 있도록 하기 위해 Vary 헤더를 제공한다.|만약 결정이 뻔하지 않으면(헤더에 맞는 것이 없으면), 서버는 추측을 해야만 한다.
투명|투명한 중간 장치(프락시 캐시)가 서버를 대신하여 협상을 한다.|웹 서버가 협상을 할 필요가 없다. 클라이언트 주도 협상보다 빠르다.|투명 협상을 어떻게 하는지에 대한 정형화된 명세가 없다.

## 17.5 트랜스코딩

* 서버가 클라이언트의 요구에 맞는 문서를 아예 갖고 있지 않다면 어떻게 되는가?

* 서버는 에러로 응답해야겠지만, 이론적으로 서버는 기존의 문서를 클라이언트가 사용할 수 있는 무언가로 변환할 수 있다.

* 이 옵션을 `트랜스코딩이`라고 부른다.

* 트랜스코딩에는 포맷 변환, 정보 합성, 내용 주입의 세 종류가 있다.

### 17.5.1 포맷 변환

* 포맷 변환은 데이터를 클라이언트가 볼 수 있도록 한 포맷에서 다른 포맷으로 변환하는 것이다.

* 예시

    - 접속 속도가 느리고 고해상도 이미지에 별로 관심 없는 클라이언트에서 이미지가 많은 페이지를 쉽게 볼 수 있게 해주려면,  
    이미지들을 컬러에서 흑백으로 변환하고 축소하여 크기와 해상도를 줄여주어야 할 것이다.


### 17.5.2 정보 합성

* 문서에서 정보의 요점을 추출하는 것을 정보 합성(information synthesis)이라고 하는데, 이는 트랜스코딩 과정에서 유용할 수 있다.

* 예시
    - 각 절의 제목에 기반한 문서의 개용 생성이나 페이지에서 광고 및 로고 제거를 들 수 있다.

* 이 기술은 포털 사이트의 웹페이지 디렉터리와 같은 자동화된 웹페이지 분류 시스템에 의해 종종 사용된다.


### 17.5.3 콘텐츠 주입

* 지금까지 서술한 두 종류의 트랜스코딩은 일반적으로 웹 문서의 양을 줄이지만, 오히려 양을 늘리는 또 다른 종류의 변환인 내용 주입 트랜스코딩이라는 것도 있다.

* 예시
    - 자동 광고 생성과 사용자 추적 시스템이 있다.

