# 8장. 통합점: 게이트웨이, 터널, 릴레이

<br>

## 소개

<br>

시간이 지나면서 사람들은 온라인에 단순 정적 문서뿐만 아니라 더운 복잡한 리소스(데이터베이스 콘텐츠나 동적으로 생성된 HTML 페이지)를 공유하기 원했다.

브라우저 같은 HTTP 애플리케이션은 인터넷상의 콘텐츠에 접근하는 통일한 방법을 제공한다.

HTTP 위에 다른 프로토콜을 얹으려고 하는 개발자들에게는 HTTP 가 기본 구성 요소이다.

예를 들어, HTTP만 허용하는 방화벽이 있는 회사에서 다른 프로토콜로 통신하는 트래픽을 HTTP로 감싸서 터널링하거나 릴레이 하는 것이다.

HTTP는 웹에 있는 모든 리소스에 대한 프로토콜로 사용되었으며, 애플리케이션 간에 서로 다른 프로토콜을 상호 운용하는 용도로 사용하기도 한다.

이 장에서는 여러 종류의 리소스에 접근하는데 HTTP가 어떻게 쓰이는지 알아보고, 다른 프로토콜이나 애플리케이션 간 통신에 HTTP를 어떻게 사용하는지 알아볼 것이다.

1. 게이트웨이 : 서로 다른 프로토콜과 애플리케이션 간의 HTTP 인터페이스
2. 애플리케이션 인터페이스 : 서로 다른 형식의 웹 애플리케이션이 통신하는 데 사용
3. 터널 : HTTP 커넥션을 통해서 HTTP가 아닌 트래픽을 전송하는 데 사용
4. 릴레이 : 일종의 단순한 HTTP 프락시로 한 번에 한 개의 홉에 데이터를 전달하는 데 사용

<br><br>

## 8.1 게이트웨이

- HTTP의 확장과 인터페이스는 사람들의 필요에 따라 발전해왔다. 웹에 더 복잡한 리소스를 올려야 할 필요가 생기면서 모든 리소스를 한 개의 애플리케이션으로만 처리할 수 없다는 것은 분명해졌다.

- 개발자들은 인터프리터 같이 리소스를 받기 위한 경로를 안내하는 역할을 하는 게이트웨이를 고안해냈다.

- `게이트웨이는 리소스와 애플리케이션을 연결하는 역할`을 한다.

- 게이트웨이는 HTTP 트래픽을 다른 프로토콜로 자동으로 변환하여 HTTP 클라이언트가 다른 프로토콜을 알 필요없이 서버에 접속할 수 있게 한다.

### 8.1.1 클라이언트 측 게이트웨이와 서버 측 게이트웨이

- 웹 게이트웨이는 한쪽에서는 HTTP로 통신하고 다른 한 쪽에서는 HTTP가 아닌 다른 프로토콜로 통신한다.

- 서버 측 게이트웨이는 클라이언트와 HTTP로 통신하고, 서버와는 외래 프로토콜로 통신한다.

- 클라이언트 측 게이트웨이는 클라이언트와 외래 프로토콜로 통신하고, 서버와는 HTTP로 통신한다.

```
참고

상이한 HTTP 버전 사이에서 변환을 수행하는 웹 프락시는 게이트웨이와 같다. 그 웹 프락시는 양쪽 사이에서 교섭을 위한 복잡한 로직을 수행하기 때문이다. 하지만 양쪽에서 HTTP로 통신하기 때문에 기술적으로는 프락시이다.
```

## 8.2 프로토콜 게이트웨이

- 프락시에 트래픽을 바로 보내는 것과 같이 게이트웨이에도 HTTP 트래픽을 바로 보낼 수 있다.

- 보통 브라우저에 명시적으로 게이트웨이를 설정하여 자연스럽게 트래픽이 게이트웨이를 거쳐 가게 하거나, 게이트웨이를 대리 서버(리버스 프락시)로 설정할 수도 있다.

### 8.2.1 HTTP/*: 서버 측 웹 게이트웨이

- 서버 측 웹 게이트웨이는 클라이언트로부터 HTTP 요청이 원 서버 영역으로 들어오는 시점에 클라이언트 측의 HTTP 요청을 외래 프로토콜로 전환한다.

<br>

<p align="center"><img src="../images/게이트웨이1.png" width="80%"></p>

<br>

### 8.2.2 HTTP/HTTPS: 서버 측 보안 게이트웨이

- 기업 내부의 모든 웹 요청을 암호화함으로써 개인 정보 보호와 보안을 제공하는데 게이트 웨이를 사용할 수 있다.

<br>

<p align="center"><img src="../images/게이트웨이2.png" width="80%"></p>

<br>

### 8.2.3 HTTPS/HTTP: 클라이언트 측 보안 가속 게이트웨이

- 보안 HTTPS 트래픽을 받아서 복호화하고, 웹 서버로 보낼 일반 HTTP 요청을 만든다.

- 이 경우 게이트웨이와 원 서버 간의 암호화하지 않은 트래픽을 전송하기 때문에, 게이트웨이와 원 서버 간에 있는 네트워크가 안전한지 확인을 하고 사용해야 한다.

<br>

<p align="center"><img src="../images/게이트웨이3.png" width="80%"></p>

<br>

## 8.3 리소스 게이트웨이

- 게이트웨이의 가장 일반적인 형태인 애플리케이션 서버는 목적지 서버와 게이트웨이를 한 개의 서버로 결합한다.

- 애플리케이션 서버는 게이트웨이의 애플리케이션 프로그래밍 인터페이스(API)를 통해서 요청을 서버에서 동작하고 있는 애플리케이션에 전달한다.

- 애플리케이션 게이트웨이에서 유명했던 최초의 API는 CGI(공용 게이트웨이 인터페이스)이다.

- CGI는 특정 URL에 대한 HTTP 요청에 따라 프로그램을 실행하고, 프로그램의 출력을 수집하고, HTTP 응답으로 회신하는데 웹 서버가 사용하는 표준화된 인터페이스 집합이다.

<br>

<p align="center"><img src="../images/게이트웨이4.png" width="80%"></p>

<br>

### 8.3.1 공용 게이트웨이 인터페이스

- CGI는 최초의 서버 확장이자 지금까지도 가장 널리쓰이는 서버 확장이다. 이는 웹에서 동적인 HTML, 신용카드 처리, 데이터베이스 질의 등을 제공하는데 쓰인다.

- CGI가 내부에서 어떤 처리를 하는지는 사용자에게 보이지 않는다. 사용자의 시각에서는 CGI가 내부적으로 일반적인 요청을 만드는 것일 뿐이다.

### 8.3.2 서버 확장 API

- CGI 프로토콜은 구동 중인 HTTP 서버에 외부 인터프리터가 쉽게 접속할 수 있게 해주지만, 서버 자체의 동작을 바꾸고 싶거나 서버의 처리 능력을 올리고자 할 때는 어떻게 할까?

- 확장 API로 해결하였다. 이러한 맞춤 인터페이스는 개발자에게 매우 유용하다.

## 8.4 애플리케이션 인터페이스와 웹 서비스

- 애플리케이션을 연결하면서 생기는 까다로운 이슈 중 하나는, 데이터를 교환하려는 두 애플리케이션 사이에서 프로토콜 인터페이스를 맞추는 일이다.

- 과거에는 SOAP을 통해 XML을 사용하여 정보를 교환했지만 현대 웹 서비스의 데이터 교환 방식은 REST 방식을 더 많이 쓰며 JSON을 주로 사용한다.
