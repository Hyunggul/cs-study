# 17장. 내용 협상과 트랜스코딩

<br>

## 소개

<br>

특정 사용자나 URL에 대해 어떤 콘텐츠가 클라이언트에게 보내주기 가장 적절한지에 대한 판단이 필요하다.

<br>

## 17.1 내용 협상 기법

- 서버에 있는 페이지들 중 어떤 것이 클라이언트에게 맞는지 판단하는 세 가지 다른 방법이 있다.

    - 클라이언트 주도 협상

    - 서버 주도 협상
    
    - 투명한 협상

## 17.2 클라이언트 주도 협상

- 클라이언트가 요청을 보내면, 서버는 클라이언트에게 선택지를 보내주고, 클라이언트가 보고 싶은 것을 선택하는 것

- 장점 : 구현이 쉽고 최선의 사본이 선택 

- 단점 : 대기 시간이 증가하고(목록을 얻은 후 사본을 얻는 2번의 요청이 필요) 여러 개의 URL(주 페이지 + 특정 조건별 페이지들)가 필요

## 17.3 서버 주도 협상

- 서버가 클라이언트의 요청 헤더를 검증해서 어떤 버전을 제공할지 결정하는 것

- 장점 : 클라이언트 주도 협상보다 빠름

- 단점 : 헤더 에 맞는 것이 없으면 서버는 추측

- 클라이언트는 아래 나열된 HTTP 헤더들을 이용하여 자신의 선호 정보를 보낸다.

    Accept : 서버가 어떤 미디어 타입으로 보내도 되는지 알려준다.

    Accept-Language : 서버가 어떤 언어로 보내도 되는지 알려준다.
    
    Accept-Charset : 서버가 어떤 차셋으로 보내도 되는지 알려준다.
    
    Accept-Encoding : 서버가 어떤 인코딩으로 보내도 되는지 알려준다.

```
예시

Accept-Language: en;q=0.5, fr;q=0.0 nl;q=1.0, tr;q=0.0

q값은 0.0부터 1.0까지의 값을 가지며 0.0은 가장 낮은 선호도 1.0은 가장 높은 선호도이다.
위의 예시로 보면 네덜란드어(nl)를 가장 선호하며 어떤 경우에는 영어도 선호한다.
그러나 어떤 경우라도 프랑스어나 터키어 버전은 원하지 않는다는 것을 알 수 있다.
```

## 17.4 투명 협상

- 투명한 중간 장치(주로 프락시 캐시)가 서버를 대신하여 협상하는 것

- 서버는 응답에 Vary 헤더를 포함시켜 보냄으로써 중개자에게 내용 협상을 위해 어떤 헤더를 사용하고 있는지 알려줄 수 있다.

### Vary 헤더

- HTTP Vary 응답 헤더는 서버가 문서를 선택하거나 커스텀 콘텐츠를 생성할 때 고려한 클라이언트
요청 헤더 모두(일반적인 내용 협상 헤더 외에 추가로 더해서)를 나열한다.

- 제공된 문서가 User-Agent 헤더에 의존한다면, Vary 헤더는 반드시 "User-Agent"를 포함해야 한다.

```
Vary: User-Agent, Cookie
```

## 17.5 트랜스 코딩

- 트랜스 코딩이란 `서버가 클라이언트의 요구에 맞는 문서를 하나도 갖고 있지 않다면, 기존의 문서를 클라이언트가 사용할 수 있는 무언가로 변환하는 옵션`이다.

- 트랜스코딩에는 포맷 변환, 정보 합성, 내용 주입의 세 종류가 있다.

### 포맷 변환 

- 포맷 변환은 데이터를 클라이언트가 볼 수 있도록 한 포맷에서 다른 포맷으로 변환하는 것이다.

- 내용 협상 헤더에 의해 주도된다.(User-Agent 헤더에 의해서 주도될 수도 있지만)

- 내용 변환, 트랜스코딩 -> 콘텐츠를 특정 접근 장치에서 볼 수 있도록 하기 위한 것

- 콘텐츠 인코딩, 전송 인코딩 -> 콘텐츠의 더 효율적인 혹은 안전한 전송을 위한 것


### 정보 합성

- 문서에서 정보의 요점을 추출하는 것을 정보 합성(information synthesis)라고 한다.

### 콘텐츠 주입

- 앞의 두 종류의 트랜스 코딩과 달리 웹 문서의 양을 늘린다. 예로 자동 광고 생성과 사용자 추적 시스템이 있다.
